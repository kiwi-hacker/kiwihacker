<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸŒŸ íë¸Œ ê°•í™” ê²Œì„ ğŸŒŸ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            padding: 20px;
            padding-bottom: 120px;
            background: linear-gradient(to bottom right, #2c3e50, #34495e);
            color: #ecf0f1;
            user-select: none;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-x: hidden;
            min-height: 100vh;
        }

        h1 {
            font-size: 2.5em;
            color: #f1c40f;
            text-shadow: 0 0 15px rgba(241, 196, 15, 0.6);
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        #money, #upgradeLevel {
            font-size: 2em;
            margin: 8px 0;
            font-weight: bold;
            color: #fff;
        }
        #money { color: #2ecc71; }
        #upgradeLevel { color: #3498db; }

        #upgradeDisplay {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 140px;
            height: 140px;
            line-height: 140px;
            border: 5px solid #fff;
            border-radius: 25px;
            font-size: 3.8em;
            color: #fff;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.7);
            transition: background-color 0.3s ease-in-out, transform 0.1s ease-out, box-shadow 0.3s ease-in-out;
            margin: 15px auto;
            box-shadow: 0 0 20px rgba(0, 204, 255, 0.5), 0 0 40px rgba(0, 204, 255, 0.3);
        }
        #upgradeDisplay:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 204, 255, 0.7), 0 0 60px rgba(0, 204, 255, 0.5);
        }
        #upgradeDisplay:active {
            transform: scale(0.98);
        }

        #successRate {
            font-size: 1.4em;
            margin-top: 10px;
            color: #bdc3c7;
        }

        #buttonContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
            margin-top: 20px;
            margin-bottom: 30px;
            max-width: 700px;
        }

        button {
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            background-color: #3498db;
            color: #fff;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            outline: none;
            white-space: nowrap;
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }
        button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        button:disabled {
            cursor: not-allowed;
            background-color: #7f8c8d;
            color: #bdc3c7;
            box-shadow: none;
            transform: none;
        }

        #earnBtn { background-color: #2ecc71; }
        #earnBtn:hover { background-color: #27ae60; }
        #upgradeBtn { background-color: #e67e22; }
        #upgradeBtn:hover { background-color: #d35400; }
        #sellBtn { background-color: #c0392b; }
        #sellBtn:hover { background-color: #a93226; }
        #immunityBtn { background-color: #9b59b6; }
        #immunityBtn:hover { background-color: #8e44ad; }
        #shopBtn { background-color: #f1c40f; color: #333; }
        #shopBtn:hover { background-color: #f39c12; }
        #inventoryBtn { background-color: #1abc9c; }
        #inventoryBtn:hover { background-color: #16a085; }
        #storeBtn, #combineBtn, #loadBtn, #settingsBtn { background-color: #34495e; border: 1px solid #7f8c8d;}
        #storeBtn:hover, #combineBtn:hover, #loadBtn:hover, #settingsBtn:hover { background-color: #2c3e50; }

        #adminToggleBtn {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background-color: #555;
            color: #fff;
            padding: 8px 12px;
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            cursor: pointer;
            font-size: 0.8em;
            display: none;
            z-index: 999;
            transition: background-color 0.2s, transform 0.2s;
        }
        #adminToggleBtn:hover {
            background-color: #777;
        }

        #message {
            font-size: 1.5em;
            color: #8be0ff;
            min-height: 30px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            text-shadow: 0 0 10px rgba(139, 224, 255, 0.4);
            width: 95%;
            max-width: 450px;
            box-sizing: border-box;
            text-align: center;

            position: fixed;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
        }
        #message.show {
            opacity: 1;
            transform: translateX(-50%);
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2c3e50;
            border: 2px solid #3498db;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.7);
            z-index: 1000;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            color: #ecf0f1;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -40%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        .modal h3 {
            margin-top: 0;
            color: #f1c40f;
            font-size: 1.8em;
            margin-bottom: 18px;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.4);
        }

        .modal div {
            margin: 10px 0;
            font-size: 1em;
            line-height: 1.4;
        }

        .modal button {
            display: block;
            width: calc(100% - 10px);
            margin: 12px 0 0 0;
            background-color: #3498db;
            padding: 10px 15px;
            font-size: 1em;
        }
        .modal button:hover { background-color: #2980b9; }

        .modal input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #7f8c8d;
            border-radius: 6px;
            background-color: #3f5268;
            color: #ecf0f1;
            font-size: 1em;
            box-sizing: border-box;
        }
        .modal input[type="text"]::placeholder {
            color: #bdc3c7;
        }

        .selectable label {
            display: flex;
            align-items: center;
            margin: 6px 0;
            padding: 8px 12px;
            border: 1px solid #7f8c8d;
            border-radius: 6px;
            cursor: pointer;
            background-color: #34495e;
            transition: background-color 0.2s, border-color 0.2s;
            font-size: 0.95em;
        }
        .selectable label:hover {
            background-color: #3f5268;
            border-color: #3498db;
        }
        .selectable label.selected {
            background: #3498db;
            border: 2px solid #f1c40f;
            font-weight: bold;
            box-shadow: 0 0 8px rgba(241, 196, 15, 0.5);
        }
        .selectable input[type="radio"] {
            margin-right: 8px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid #ecf0f1;
            border-radius: 50%;
            background-color: #7f8c8d;
            outline: none;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .selectable input[type="radio"]:checked {
            background-color: #f1c40f;
            border-color: #fff;
        }
        .selectable input[type="radio"]:hover {
            background-color: #bdc3c7;
        }

        #combine .modal-content-flex {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #combine .modal-content-flex > div {
            flex: 1;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #7f8c8d;
            border-radius: 8px;
            padding: 8px;
            background-color: #34495e;
        }
        #combine .modal-content-flex > div strong {
            display: block;
            margin-bottom: 8px;
            color: #f1c40f;
        }

        #inventory .item-status {
            color: #2ecc71;
            font-weight: bold;
        }
        #inventory .item-status.missing {
            color: #e74c3c;
        }
        #inventory #itemHidden100 { /* Changed ID */
            color: #9b59b6;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #7f8c8d;
        }
        #inventory #itemLink.item-status {
            color: #a4c639;
        }


        #clearScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #1a2a3a, #0a1a2a, #1a2a3a);
            color: #fff;
            font-size: 4em;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
            text-shadow: 0 0 20px #fff, 0 0 40px #f0f, 0 0 60px #0ff;
        }
        #clearScreen .marquee {
            font-size: 0.7em;
            padding: 15px 0;
            white-space: nowrap;
            overflow: hidden;
            box-sizing: border-box;
            animation: marquee 15s linear infinite;
        }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        #clearScreen .sub-message {
            font-size: 0.35em;
            color: #f1c40f;
            margin-top: 25px;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0; }
        }

        #hiddenClear {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: hiddenClearBg 10s infinite alternate;
            overflow: hidden;
        }

        @keyframes hiddenClearBg {
            0% { background-color: #0a0a0a; }
            25% { background-color: #2b0a3a; }
            50% { background-color: #0a2b3a; }
            75% { background-color: #2b3a0a; }
            100% { background-color: #0a0a0a; }
        }

        #hiddenClearCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #hiddenClearTextContainer {
            position: relative;
            z-index: 2;
            text-align: center;
            font-size: 4.5em;
            font-weight: bold;
            text-shadow: 0 0 30px #fff, 0 0 60px #f0f, 0 0 90px #0ff, 0 0 120px #ff0;
            animation: textSparkle 1.5s infinite alternate;
        }

        @keyframes textSparkle {
            0% { text-shadow: 0 0 30px #fff, 0 0 60px #f0f, 0 0 90px #0ff, 0 0 120px #ff0; }
            50% { text-shadow: 0 0 40px #fff, 0 0 80px #f0f, 0 0 120px #0ff, 0 0 160px #ff0, 0 0 200px rgba(255,255,255,0.8); }
            100% { text-shadow: 0 0 30px #fff, 0 0 60px #f0f, 0 0 90px #0ff, 0 0 120px #ff0; }
        }

        #hiddenClear .sub-message {
            font-size: 0.5em;
            margin-top: 40px;
            color: #f1c40f;
            text-shadow: 0 0 10px #f1c40f;
            animation: subMessagePulse 2s infinite ease-in-out;
        }

        @keyframes subMessagePulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }


        #adminPanel {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%) translateX(100%);
            background: #1a2a3a;
            border: 2px solid #f1c40f;
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
            color: #ecf0f1;
            padding: 20px;
            width: 280px;
            z-index: 1001;
            display: none;
            text-align: left;
            transition: transform 0.3s ease-out;
        }
        #adminPanel.open {
            transform: translateY(-50%) translateX(0);
        }

        #adminPanel h3 {
            color: #f1c40f;
            margin-bottom: 20px;
            font-size: 2em;
        }
        #adminPanel button {
            background-color: #e67e22;
            margin-bottom: 8px;
            width: 100%;
            padding: 10px 15px;
            font-size: 0.95em;
        }
        #adminPanel button:hover { background-color: #d35400; }
        #adminPanel #passwordList {
            background-color: #0a1a2a;
            border: 1px solid #7f8c8d;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
            color: #bdc3c7;
            font-size: 1em;
        }
        #adminPanel #passwordList ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #adminPanel #passwordList li {
            padding: 4px 0;
            border-bottom: 1px dashed rgba(127,140,141,0.3);
        }
        #adminPanel #passwordList li:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 1.1em;
            cursor: pointer;
        }

        .toggle-switch input[type="checkbox"] {
            display: none;
        }

        .toggle-switch .slider {
            width: 50px;
            height: 26px;
            background-color: #ccc;
            border-radius: 26px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.4s;
        }

        .toggle-switch .slider:before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            top: 3px;
            left: 3px;
            transition: transform 0.4s;
        }

        .toggle-switch input[type="checkbox"]:checked + .slider {
            background-color: #2196F3;
        }

        .toggle-switch input[type="checkbox"]:checked + .slider:before {
            transform: translateX(24px);
        }

        .success-gauge-container {
            width: 100%;
            background-color: #444;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            border: 1px solid #777;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .success-gauge-fill {
            height: 20px;
            background: linear-gradient(to right, #2ecc71, #f1c40f);
            width: 0%;
            border-radius: 10px;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 0.9em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            #money, #upgradeLevel { font-size: 1.8em; }
            #upgradeDisplay { width: 120px; height: 120px; font-size: 3.5em; }
            #successRate { font-size: 1.2em; }
            #buttonContainer { gap: 5px; max-width: none; }
            button { padding: 8px 12px; font-size: 0.9em; }
            .modal { max-width: 95%; padding: 20px; }
            .modal h3 { font-size: 1.6em; }
            .modal div { font-size: 0.95em; }
            .modal button { padding: 8px 12px; font-size: 0.95em; }
            .selectable label { padding: 6px 10px; font-size: 0.9em; }
            #combine .modal-content-flex { flex-direction: column; }
            #adminPanel { width: 250px; padding: 15px; }
            #adminPanel h3 { font-size: 1.8em; }
            #adminPanel button { font-size: 0.9em; }
            #passwordList { font-size: 0.9em; }
        }

    </style>
</head>
<body>
    <button id="adminToggleBtn" onclick="toggleAdminPanel()" style="display: block;">ğŸ”’ ê´€ë¦¬ì íŒ¨ë„</button>

    <h1>ğŸŒŸ íë¸Œ ê°•í™” ê²Œì„ ğŸŒŸ</h1>
    <div id="money">ğŸ’° í˜„ì¬ ëˆ: 427,100ì›</div>
    <div id="upgradeLevel">ğŸ”° ê°•í™” ë‹¨ê³„: 25</div>
    <div id="upgradeDisplay" onclick="openPasswordModal()" style="background: rgb(26, 230, 182);">25</div>
    <div id="successRate">ğŸ“ˆ ì„±ê³µ í™•ë¥ : 14.75%</div>
    <br>
    <div id="buttonContainer">
        <button id="earnBtn" onclick="clickToEarn()">í´ë¦­í•˜ì—¬ 100ì› íšë“</button>
        <button id="upgradeBtn" onclick="attemptUpgrade()">ê°•í™” ì‹œë„ (1000ì›)</button>
        <button id="sellBtn" onclick="sell()">ğŸ”„ íŒë§¤í•˜ê¸°</button>
        <button id="shopBtn" onclick="openModal('shop')">ğŸª ìƒì </button>
        <button id="immunityBtn" onclick="useImmunity()" disabled="">ğŸ›¡ ì‹¤íŒ¨ ë©´ì œê¶Œ ì‚¬ìš©</button>
        <button id="inventoryBtn" onclick="openModal('inventory')">ğŸ’ ì¸ë²¤í† ë¦¬</button>
        <button id="storeBtn" onclick="storeCube()">ğŸ“¦ ë³´ê´€í•˜ê¸°</button>
        <button id="combineBtn" onclick="openModal('combine')">ğŸ”— ì¡°í•©</button>
        <button id="loadBtn" onclick="openModal('load')">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button id="settingsBtn" onclick="openModal('settingsModal')">âš™ï¸ ì„¤ì •</button>
    </div>
    <div id="message" class="">ê°•í™” ì‹¤íŒ¨í–ˆì§€ë§Œ ë©´ì œê¶Œ ìë™ ì‚¬ìš©ìœ¼ë¡œ ë‹¨ê³„ ìœ ì§€!</div>

    <div id="clearScreen" style="display: none;">
        <div class="marquee">ğŸ†ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ê²Œì„ì„ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤! ğŸ‰ğŸ†</div>
        <div class="sub-message">ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ F5 ë˜ëŠ” Ctrl+R</div>
    </div>

    <div id="hiddenClear" style="display: none;">
        <canvas id="hiddenClearCanvas" width="982" height="738"></canvas>
        <div id="hiddenClearTextContainer">âœ¨ğŸ‰ HIDDEN CLEAR! ğŸ‰âœ¨</div>
        <div class="sub-message">ì´ê²ƒì€... ë‹¹ì‹ ì˜ ìƒìƒì„ ì´ˆì›”í•˜ëŠ” ê²°ê³¼ì…ë‹ˆë‹¤!</div>
    </div>

    <div id="shop" class="modal" style="display: none;">
        <h3>ğŸª ìƒì </h3>
        <div>ì‹¤íŒ¨ ë©´ì œê¶Œ (8000ì›): ì‹¤íŒ¨ ì‹œ ì§ì „ ë‹¨ê³„ë¡œ ë³µêµ¬ <button onclick="buyImmunity()">êµ¬ë§¤</button></div>
        <div>ë¶€ìŠ¤íŠ¸ (30000ì›): ë‹¤ìŒ 10íšŒ ê°•í™” í™•ë¥  2.5ë°° <button onclick="buyBoost()">êµ¬ë§¤</button></div>
        <button onclick="closeModal('shop')">ë‹«ê¸°</button>
    </div>

    <div id="inventory" class="modal" style="display: none;">
        <h3>ğŸ’ ì¸ë²¤í† ë¦¬</h3>
        <div>50ê°•ì˜ íë¸Œ: <span id="item50" class="item-status">âœ… íšë“</span></div>
        <div>ë¯¸ì§€ì˜ ìš´: <span id="itemLuck" class="item-status">âœ… íšë“</span></div>
        <div>30ê°•ì˜ ë¶€ìŠ¤í„°: <span id="itemB30" class="item-status">âœ… íšë“</span></div>
        <div>ì´ìƒí•œ 50ê°•: <span id="itemW50" class="item-status">âœ… íšë“</span></div>
        <div style="margin-top:20px;">
            ë³´ê´€ íë¸Œ(ë‹¨ê³„ë³„): <span id="itemStored" class="item-status">0, 0, 50, 50</span>
        </div>
        <div>
            ì—°ê²°ëœ íë¸Œ(ë‹¨ê³„ë³„): <span id="itemConnected" class="item-status">ì—†ìŒ</span>
        </div>
        <div id="linkItemDisplay" style="display: block;">
            ì—°ê²° ê³ ë¦¬: <span id="itemLink" class="item-status">âœ… íšë“ (Xê°œ)</span>
        </div>
        <div id="boosterQuestionDisplay" style="display: block;">
            ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°?: <span id="itemBoosterQuestion" class="item-status">âœ… íšë“ (Xê°œ)</span>
        </div>
        <div id="hidden100Display" style="display: block;"> (íˆë“ )100ê°• íë¸Œ: <span id="itemHidden100" class="item-status">âŒ ë¯¸íšë“</span>
        </div>
        <div>ëˆ: <span id="itemMoney" class="missing">ë¶€ì¡±</span></div>
        <h3 style="margin-top:30px;">âœ… í´ë¦¬ì–´ ì¡°ê±´</h3>
        <div>â€¢ 50ê°•ì˜ íë¸Œ íšë“</div>
        <div>â€¢ ëˆ 1,000,000ì› ì´ìƒ</div>
        <div>â€¢ ë¯¸ì§€ì˜ ìš´ íšë“</div>
        <div>â€¢ 30ê°•ì˜ ë¶€ìŠ¤í„° íšë“</div>
        <div>â€¢ ì´ìƒí•œ 50ê°• íšë“</div>
        <button id="clearBtn" onclick="tryClear()" disabled="">ğŸ† í´ë¦¬ì–´</button>
        <button onclick="closeModal('inventory')">ë‹«ê¸°</button>
    </div>

    <div id="combine" class="modal" style="display: none;">
        <h3>ğŸ”— ì•„ì´í…œ ì¡°í•©</h3>
        <div class="modal-content-flex">
            <div><strong>ì²« ë²ˆì§¸ ì•„ì´í…œ:</strong><div id="comb1" class="selectable"></div></div>
            <div><strong>ë‘ ë²ˆì§¸ ì•„ì´í…œ:</strong><div id="comb2" class="selectable"></div></div>
        </div>
        <button onclick="combineItems()">ì¡°í•© ì‹¤í–‰</button>
        <button id="closeCombineModalBtn" onclick="closeModal('combine')">ë‹«ê¸°</button>
    </div>

    <div id="load" class="modal" style="display: none;">
        <h3>ğŸ“¥ ë³´ê´€ íë¸Œ ë¶ˆëŸ¬ì˜¤ê¸°</h3>
        <div><strong>ì„ íƒ:</strong><div id="loadSel" class="selectable"></div></div>
        <button onclick="loadCube()">í™•ì¸</button>
        <button id="closeLoadModalBtn" onclick="closeModal('load')">ë‹«ê¸°</button>
    </div>

    <div id="passwordModal" class="modal" style="display: none;">
        <h3>ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
        <input type="text" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
        <button onclick="checkPassword()">í™•ì¸</button>
        <button onclick="closeModal('passwordModal')">ë‹«ê¸°</button>
    </div>

    <div id="settingsModal" class="modal" style="display: none;">
        <h3>âš™ï¸ ì„¤ì •</h3>
        <div class="success-gauge-container">
            <div class="success-gauge-fill" id="settingsSuccessGauge"></div>
        </div>
        <label class="toggle-switch">
            <span>ë©´ì œê¶Œ ìë™ ì‚¬ìš©</span>
            <input type="checkbox" id="autoImmunityToggle" onchange="toggleAutoImmunity()">
            <span class="slider"></span>
        </label>
        <label class="toggle-switch">
            <span>ê°•í™” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼</span>
            <input type="checkbox" id="animationToggle" onchange="toggleAnimation()">
            <span class="slider"></span>
        </label>
        <button onclick="openModal('resetConfirmModal')" style="background-color: #c0392b;">âš ï¸ ê²Œì„ ì´ˆê¸°í™”</button>
        <button onclick="closeModal('settingsModal')">ë‹«ê¸°</button>
    </div>

    <div id="resetConfirmModal" class="modal" style="display: none;">
        <h3>âš ï¸ ê²Œì„ ì´ˆê¸°í™”</h3>
        <div>ì •ë§ë¡œ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
        <div>ëª¨ë“  ì§„í–‰ ìƒí™©ê³¼ ì•„ì´í…œì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤!</div>
        <button onclick="resetGameConfirmed()">ë„¤, ì´ˆê¸°í™”í•©ë‹ˆë‹¤.</button>
        <button onclick="closeModal('resetConfirmModal')">ì•„ë‹ˆìš”, ì·¨ì†Œí•©ë‹ˆë‹¤.</button>
    </div>

    <div id="adminPanel" class="modal" style="display: none;">
        <h3>ğŸ”’ ê´€ë¦¬ì íŒ¨ë„</h3>
        <div id="passwordList">
            <p><strong>âœ… ë“±ë¡ëœ ë¹„ë°€ë²ˆí˜¸ ëª©ë¡ (ì°¸ê³ ìš©)</strong></p>
            <ul>
                <li>ë­™ë³½í™ê´€ë¦¬ì</li>
                <li>í™©ë„ìœ¤ì²œì¬[n] (nì€ 0-50)</li>
                <li>ì´ì§€ìš°ì²œì¬</li>
                <li>ì¨ˆë¯¼ì´ëª¨ì´¹</li>
                <li>ì—°ê²°ê³ ë¦¬!</li>
                <li>ë¯¸ì§€ì˜ ìš´</li>
                <li>30ê°•ë¶€ìŠ¤í„° (ì´ì œ ì§ì ‘ íšë“X, ì¡°í•©ìœ¼ë¡œë§Œ)</li>
                <li>ì–´ì©Œë‹¤ë¶€ìŠ¤í„°!</li>
                <li>ì´ìƒí•œ50ê°• (ì´ì œ ì§ì ‘ íšë“X, íŠ¹ì • ê°•í™” ì¡°ê±´ìœ¼ë¡œë§Œ)</li>
            </ul>
        </div>
        <button onclick="adminAddMoney()">ğŸ’° ëˆ 1,000,000ì› ì¶”ê°€</button>
        <button onclick="adminSetLevel()">ğŸ‘‘ ê°•í™” ë‹¨ê³„ 50ìœ¼ë¡œ ì„¤ì •</button>
        <button onclick="adminGetAllItems()">ğŸ ëª¨ë“  í´ë¦¬ì–´ ì•„ì´í…œ íšë“</button>
        <button onclick="adminAddImmunity()">ğŸ›¡ ë©´ì œê¶Œ 10ê°œ ì¶”ê°€</button>
        <button onclick="adminAddLink()">ğŸ”— ì—°ê²° ê³ ë¦¬ 5ê°œ ì¶”ê°€</button>
        <button onclick="adminAddBoosterQuestion()">â“ ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°? 1ê°œ ì¶”ê°€</button>
        <button onclick="adminAddHidden100()">ğŸ’¯ (íˆë“ )100ê°• íë¸Œ ì¶”ê°€</button> <button onclick="toggleAdminPanel()">âœ– ë‹«ê¸°</button>
    </div>

<script>
    const MAX_LEVEL = 50;

    const colors = [
        "red","orange","yellow","green","blue","indigo","violet",
        ...Array(MAX_LEVEL - 6).fill(0).map((_,i)=>`hsl(${(i * 7 + 40)%360},80%,50%)`)
    ];
    colors[MAX_LEVEL] = "gray";

    let money = 100;
    let level = 0;
    let immunity = 0;
    let boost = 0;
    let lastUpgradeSuccess = true;
    let autoImmunity = false;
    let enableAnimation = true;

    let has50 = false;
    let hasLuck = false; // ë¯¸ì§€ì˜ ìš´ (1íšŒ íšë“)
    let hasB30 = false; // 30ê°•ì˜ ë¶€ìŠ¤í„° (1íšŒ íšë“ - ì¡°í•©ìœ¼ë¡œë§Œ)
    let hasW50 = false; // ì´ìƒí•œ 50ê°• (1íšŒ íšë“ - íŠ¹ì • ê°•í™” ì¡°ê±´ìœ¼ë¡œë§Œ)
    let linkCount = 0; // ì—°ê²° ê³ ë¦¬ ê°œìˆ˜ (ë¬´í•œ íšë“ ê°€ëŠ¥)
    let hasBoosterQuestion = false; // ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°? (1íšŒ íšë“)

    let hasHidden100 = false; // (íˆë“ )100ê°• íë¸Œ (1íšŒ íšë“)

    const storedCubes = []; // ë³´ê´€ íë¸Œ
    const connectedCubes = []; // {level: N, id: M} í˜•íƒœë¡œ ì €ì¥ë˜ëŠ” ì—°ê²°ëœ íë¸Œ
    let connectedIdCounter = 0; // ì—°ê²°ëœ íë¸Œì˜ ê³ ìœ  ID ë¶€ì—¬ë¥¼ ìœ„í•œ ì¹´ìš´í„°

    let successHistory = []; // ì—°ê²°ê³ ë¦¬ íšë“ì„ ìœ„í•œ ê°•í™” ì„±ê³µ/ì‹¤íŒ¨ ê¸°ë¡

    let selectedCombineA = null; // ì¡°í•© ì‹œ ì„ íƒëœ ì²« ë²ˆì§¸ ì•„ì´í…œ
    let selectedCombineB = null; // ì¡°í•© ì‹œ ì„ íƒëœ ë‘ ë²ˆì§¸ ì•„ì´í…œ
    let selectedLoadIndex = null; // ë¶ˆëŸ¬ì˜¤ê¸° ì‹œ ì„ íƒëœ ë³´ê´€ íë¸Œ ì¸ë±ìŠ¤

    const canvas = document.getElementById('hiddenClearCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let animationFrameId;

    // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ ìœ„ ë§ˆìš°ìŠ¤ ìƒíƒœ í”Œë˜ê·¸
    let isMouseOverModalCloseButton = false;

    function initGame() {
        loadGame();
        
        if (money === undefined || level === undefined) {
            resetGameData(); // ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
        }

        document.getElementById('clearScreen').style.display = 'none';
        document.getElementById('hiddenClear').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('adminPanel').classList.remove('open');
        document.getElementById('adminToggleBtn').style.display = 'none';

        document.getElementById('autoImmunityToggle').checked = autoImmunity;
        document.getElementById('animationToggle').checked = enableAnimation;

        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            particles = [];
        }

        updateUI();
        showMessage('ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!');

        // ë‹«ê¸° ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ì¡°í•©, ë¶ˆëŸ¬ì˜¤ê¸° ëª¨ë‹¬)
        document.getElementById('closeCombineModalBtn').addEventListener('mouseenter', () => isMouseOverModalCloseButton = true);
        document.getElementById('closeCombineModalBtn').addEventListener('mouseleave', () => isMouseOverModalCloseButton = false);

        document.getElementById('closeLoadModalBtn').addEventListener('mouseenter', () => isMouseOverModalCloseButton = true);
        document.getElementById('closeLoadModalBtn').addEventListener('mouseleave', () => isMouseOverModalCloseButton = false);

    }

    function showMessage(text) {
        const messageEl = document.getElementById('message');
        messageEl.innerText = text;
        messageEl.classList.add('show');
        clearTimeout(messageEl.messageTimeout);
        messageEl.messageTimeout = setTimeout(() => {
            messageEl.classList.remove('show');
        }, 3000);
    }

    function openModal(id) {
        document.querySelectorAll('.modal').forEach(m => {
            m.style.display = 'none';
        });
        const modal = document.getElementById(id);
        modal.style.display = 'block';

        if (id === 'settingsModal') {
            updateUI();
        } else if (id === 'combine') {
            showCombine();
        } else if (id === 'load') {
            showLoad();
        } else if (id === 'passwordModal') {
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
        } else if (id === 'inventory') {
            document.getElementById('linkItemDisplay').style.display = linkCount > 0 ? 'block' : 'none';
            document.getElementById('boosterQuestionDisplay').style.display = hasBoosterQuestion ? 'block' : 'none';
            document.getElementById('hidden100Display').style.display = 'block'; // Always display, status determines content
        }
    }

    function closeModal(id) {
        const modal = document.getElementById(id);
        modal.style.display = 'none';
        saveGame();
    }

    function updateUI() {
        document.getElementById('money').innerText = `ğŸ’° í˜„ì¬ ëˆ: ${money.toLocaleString()}ì›`;
        document.getElementById('upgradeLevel').innerText = `ğŸ”° ê°•í™” ë‹¨ê³„: ${level}`;

        const upgradeDisplay = document.getElementById('upgradeDisplay');
        upgradeDisplay.innerText = level;
        upgradeDisplay.style.background = colors[Math.min(level, MAX_LEVEL)];

        let successRate = Math.pow(0.9263, level);
        if (boost > 0) {
            successRate *= 2.5;
            // boost--; // ë¶€ìŠ¤íŠ¸ëŠ” íšŸìˆ˜ ì°¨ê°ì€ ê°•í™” ì‹œë„ í•¨ìˆ˜ì—ì„œë§Œ!
        }
        successRate = Math.min(successRate, 1);
        document.getElementById('successRate').innerText = `ğŸ“ˆ ì„±ê³µ í™•ë¥ : ${(successRate * 100).toFixed(2)}%`;

        const settingsSuccessGauge = document.getElementById('settingsSuccessGauge');
        settingsSuccessGauge.style.width = `${(successRate * 100).toFixed(2)}%`;
        settingsSuccessGauge.innerText = `${(successRate * 100).toFixed(0)}%`;


        const isClearScreenActive = document.getElementById('clearScreen').style.display === 'flex';
        const isHiddenClearActive = document.getElementById('hiddenClear').style.display === 'flex';

        const allButtons = document.querySelectorAll('button');
        allButtons.forEach(button => {
            if (button.id === 'adminToggleBtn' || (button.onclick && (button.onclick.toString().includes("openModal(") || button.onclick.toString().includes("closeModal("))) || button.id === 'clearBtn') {
                button.disabled = false;
            } else {
                button.disabled = isClearScreenActive || isHiddenClearActive;
            }
        });

        if (!isClearScreenActive && !isHiddenClearActive) {
            document.getElementById('upgradeBtn').disabled = money < 1000;
            document.getElementById('immunityBtn').disabled = immunity <= 0 || lastUpgradeSuccess;
            document.getElementById('sellBtn').disabled = level < 2;

            document.getElementById('item50').className = has50 ? 'item-status' : 'item-status missing';
            document.getElementById('item50').innerText = has50 ? 'âœ… íšë“' : 'âŒ ë¯¸íšë“';
            document.getElementById('itemLuck').className = hasLuck ? 'item-status' : 'item-status missing';
            document.getElementById('itemLuck').innerText = hasLuck ? 'âœ… íšë“' : 'âŒ ë¯¸íšë“';
            document.getElementById('itemB30').className = hasB30 ? 'item-status' : 'item-status missing';
            document.getElementById('itemB30').innerText = hasB30 ? 'âœ… íšë“' : 'âŒ ë¯¸íšë“';
            document.getElementById('itemW50').className = hasW50 ? 'item-status' : 'item-status missing';
            document.getElementById('itemW50').innerText = hasW50 ? 'âœ… íšë“' : 'âŒ ë¯¸íšë“';
            
            document.getElementById('linkItemDisplay').style.display = linkCount > 0 ? 'block' : 'none';
            document.getElementById('itemLink').className = linkCount > 0 ? 'item-status' : 'item-status missing'; 
            document.getElementById('itemLink').innerText = `âœ… íšë“ (${linkCount}ê°œ)`;

            document.getElementById('boosterQuestionDisplay').style.display = hasBoosterQuestion ? 'block' : 'none';
            document.getElementById('itemBoosterQuestion').className = hasBoosterQuestion ? 'item-status' : 'item-status missing';
            document.getElementById('itemBoosterQuestion').innerText = hasBoosterQuestion ? 'âœ… íšë“ (1ê°œ)' : 'âŒ ë¯¸íšë“';

            document.getElementById('itemHidden100').className = hasHidden100 ? 'item-status' : 'item-status missing';
            document.getElementById('itemHidden100').innerText = hasHidden100 ? 'âœ… íšë“' : 'âŒ ë¯¸íšë“';
            
            document.getElementById('itemMoney').className = money >= 1000000 ? 'item-status' : 'item-status missing';
            document.getElementById('itemMoney').innerText = money >= 1000000 ? 'âœ… ì¶©ë¶„' : 'âŒ ë¶€ì¡±';

            document.getElementById('itemStored').innerText = storedCubes.length > 0 ? storedCubes.map(c => `${c}ê°•`).join(', ') : 'ì—†ìŒ';
            document.getElementById('itemConnected').innerText = connectedCubes.length > 0 ? connectedCubes.map(c => `${c.level}ê°• (ID: ${c.id})`).join(', ') : 'ì—†ìŒ';


            const clearConditionsMet = has50 && money >= 1000000 && hasLuck && hasB30 && hasW50;
            document.getElementById('clearBtn').disabled = !clearConditionsMet;
        }

        document.getElementById('autoImmunityToggle').checked = autoImmunity;
        document.getElementById('animationToggle').checked = enableAnimation;
    }

    function clickToEarn() {
        money += 100;
        updateUI();
        showMessage('100ì› íšë“!');
        saveGame();
    }

    function attemptUpgrade() {
        if (money < 1000) {
            showMessage('ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ê°•í™”ì— 1000ì›ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
        }

        if (level >= MAX_LEVEL) {
            showMessage('ê°•í™”ëŠ” 50ê°•ì´ ìµœëŒ€ì…ë‹ˆë‹¤!');
            return;
        }
        money -= 1000;
        let upgradeResult = false;

        let successRate = Math.pow(0.9263, level);
        if (boost > 0) {
            successRate *= 2.5;
            boost--;
        }

        const chance = Math.random();

        if (chance < successRate) {
            level++;
            upgradeResult = true;
            lastUpgradeSuccess = true;
            showMessage(`ê°•í™” ì„±ê³µ! í˜„ì¬ ${level}ê°•!`);
            if (enableAnimation) {
                animateCubeColor('success');
            }
            // ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°? íšë“ (ê°•í™” ì„±ê³µ ì‹œ)
            if (!hasBoosterQuestion && level === 30 && lastUpgradeSuccess) {
                hasBoosterQuestion = true;
                showMessage('ì•„ì´í…œ "ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°?"ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!');
            }

            // ì´ìƒí•œ 50ê°• íšë“ (50ê°• ë‹¬ì„± ì‹œ)
            if (level === 50 && !hasW50) {
                hasW50 = true;
                showMessage('ì•„ì´í…œ "ì´ìƒí•œ 50ê°•"ì„ íšë“í–ˆìŠµë‹ˆë‹¤!');
            }
            
            } else {
                    upgradeResult = false;
                    lastUpgradeSuccess = false;
                    if (autoImmunity && immunity > 0) {
                        immunity--;
                        showMessage('ê°•í™” ì‹¤íŒ¨í–ˆì§€ë§Œ ë©´ì œê¶Œ ìë™ ì‚¬ìš©ìœ¼ë¡œ ë‹¨ê³„ ìœ ì§€!');
                    } else {
                        level = Math.max(0, level - 1);
                        showMessage(`ê°•í™” ì‹¤íŒ¨! í˜„ì¬ ${level}ê°•!`);
                    }
                    if (enableAnimation) {
                        animateCubeColor('fail');
                    }
            }

        // ì—°ê²° ê³ ë¦¬ íšë“ ë¡œì§
        successHistory.push(upgradeResult);
        if (successHistory.length > 5) { // ìµœê·¼ 5íšŒë§Œ ê¸°ë¡
            successHistory.shift();
        }

        // 5ì—°ì† ì„±ê³µ ë˜ëŠ” 5ì—°ì† ì‹¤íŒ¨ ì‹œ ì—°ê²° ê³ ë¦¬ íšë“
        if (successHistory.length === 5) {
            const allSuccess = successHistory.every(result => result === true);
            const allFail = successHistory.every(result => result === false);
            if (allSuccess || allFail) {
                linkCount++;
                showMessage('ì•„ì´í…œ "ì—°ê²° ê³ ë¦¬"ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!');
                successHistory = []; // ì—°ê²° ê³ ë¦¬ íšë“ ì‹œ ê¸°ë¡ ì´ˆê¸°í™”
            }
        }
        
        updateUI();
        saveGame();
    }

    function sell() {
        if (level < 2) {
            showMessage('2ê°•ë¶€í„° íŒë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        const sellPrice = level * 2000;
        money += sellPrice;

        // ------ 50ê°• íë¸Œ íŒë§¤ ì‹œ 50ë§Œì› ë³´ë„ˆìŠ¤ ì¶”ê°€ ë¡œì§ ------
        if (level === 50) { // í˜„ì¬ ê°•í™” ë ˆë²¨ì´ 50ì¸ì§€ í™•ì¸
            money += 500000; // 50ë§Œì› ì¶”ê°€
           showMessage('50ê°• íë¸Œ íŒë§¤! 50ë§Œì›ë„ ë³´~ë„ˆ~ìŠ¤');
       }
        // ------------------------------------------------------------------

        level = 0; // íŒë§¤ í›„ ë ˆë²¨ì„ 0ìœ¼ë¡œ ì´ˆê¸°í™”
        showMessage(`${sellPrice}ì›ì— íŒë§¤! íë¸Œê°€ 0ê°•ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        updateUI(); // UI ì—…ë°ì´íŠ¸
        saveGame(); // ê²Œì„ ìƒíƒœ ì €ì¥
    }

    function buyImmunity() {
        if (money >= 8000) {
            money -= 8000;
            immunity++;
            showMessage('ì‹¤íŒ¨ ë©´ì œê¶Œì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!');
            updateUI();
            saveGame();
        } else {
            showMessage('ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
        }
    }

    function buyBoost() {
        if (money >= 30000) {
            money -= 30000;
            boost += 10;
            showMessage('ë¶€ìŠ¤íŠ¸ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ 10íšŒ ê°•í™” í™•ë¥  2.5ë°°!');
            updateUI();
            saveGame();
        } else {
            showMessage('ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
        }
    }

    function useImmunity() {
        if (!lastUpgradeSuccess && immunity > 0) {
            immunity--;
            lastUpgradeSuccess = true; // ë©´ì œê¶Œ ì‚¬ìš© í›„ì—ëŠ” ë§ˆì§€ë§‰ ê°•í™” ì„±ê³µìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ì¬ì‚¬ìš© ë°©ì§€
            showMessage('ì‹¤íŒ¨ ë©´ì œê¶Œì„ ì‚¬ìš©í•˜ì—¬ ê°•í™” ë‹¨ê³„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤!');
            updateUI();
            saveGame();
        } else if (lastUpgradeSuccess) {
            showMessage('ì´ì „ ê°•í™”ê°€ ì„±ê³µí–ˆê±°ë‚˜ ì´ë¯¸ ë©´ì œê¶Œì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.');
        } else {
            showMessage('ì‹¤íŒ¨ ë©´ì œê¶Œì´ ì—†ìŠµë‹ˆë‹¤.');
        }
    }

    function storeCube() {
        if (storedCubes.length >= 10) {
            showMessage('ë³´ê´€í•¨ì´ ê°€ë“ ì°¨ ìˆì–´ ì¡°í•© ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        storedCubes.push(level);
        level = 0;
        showMessage(`í˜„ì¬ íë¸Œ(${level}ê°•)ë¥¼ ë³´ê´€í–ˆìŠµë‹ˆë‹¤.`);
        updateUI();
        saveGame();
    }

    function showLoad() {
        const loadSelDiv = document.getElementById('loadSel');
        loadSelDiv.innerHTML = '';
        selectedLoadIndex = null; // ì„ íƒ ì´ˆê¸°í™”

        if (storedCubes.length === 0) {
            loadSelDiv.innerHTML = '<p>ë³´ê´€ëœ íë¸Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }


        storedCubes.forEach((cubeLevel, index) => {
            const label = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'loadCube';
            radio.value = index;
            radio.onchange = () => {
                selectedLoadIndex = index;
                // ëª¨ë“  labelì˜ selected í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('#loadSel label').forEach(l => l.classList.remove('selected'));
                // í˜„ì¬ ì„ íƒëœ labelì— selected í´ë˜ìŠ¤ ì¶”ê°€
                label.classList.add('selected');
            };
            
            label.appendChild(radio);
            label.appendChild(document.createTextNode(`${cubeLevel}ê°• íë¸Œ`));
            loadSelDiv.appendChild(label);

            // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            label.addEventListener('mouseenter', () => {
                if (label.querySelector('input').checked) {
                    label.classList.add('selected');
                }
            });
            label.addEventListener('mouseleave', () => {
                if (!label.querySelector('input').checked && !isMouseOverModalCloseButton) { // ë‹«ê¸° ë²„íŠ¼ ìœ„ì— ìˆì§€ ì•Šì„ ë•Œë§Œ í•´ì œ
                    label.classList.remove('selected');
                }
            });
        });
    }

    function loadCube() {
            if (selectedLoadIndex !== null) {
            if (level !== 0) {
                if (storedCubes.length >= 10) {
                    showMessage('ë³´ê´€í•¨ì´ ê°€ë“ ì°¨ ìˆì–´ í˜„ì¬ íë¸Œë¥¼ ë³´ê´€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                storedCubes.push(level);  // í˜„ì¬ íë¸Œ ë³´ê´€
                showMessage(`í˜„ì¬ ${level}ê°• íë¸Œë¥¼ ë³´ê´€í•¨ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.`);
            }

            level = storedCubes[selectedLoadIndex];  // ë³´ê´€ëœ íë¸Œ ë¶ˆëŸ¬ì˜¤ê¸°
            storedCubes.splice(selectedLoadIndex, 1); // ì‚­ì œ

            showMessage(`ë³´ê´€ëœ ${level}ê°• íë¸Œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
            closeModal('load');
            updateUI();
            saveGame();
        } else {
            showMessage('ë¶ˆëŸ¬ì˜¬ íë¸Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        }
    }


    function showCombine() {
        const comb1Div = document.getElementById('comb1');
        const comb2Div = document.getElementById('comb2');
        comb1Div.innerHTML = '';
        comb2Div.innerHTML = '';
        selectedCombineA = null;
        selectedCombineB = null;

        const availableItems = [
            ...storedCubes.map((l, idx) => ({ type: 'stored', level: l, label: `ë³´ê´€ íë¸Œ (${l}ê°•)`, index: idx })),
            ...connectedCubes.map(c => ({ type: 'connected', level: c.level, id: c.id, label: `ì—°ê²°ëœ íë¸Œ (${c.level}ê°• ID:${c.id})` })),
            ...(linkCount > 0 ? Array(linkCount).fill({ type: 'item', name: 'ì—°ê²°ê³ ë¦¬', label: `ì•„ì´í…œ: ì—°ê²° ê³ ë¦¬` }) : []),
            ...(hasLuck ? [{ type: 'item', name: 'ë¯¸ì§€ì˜ìš´', label: `ì•„ì´í…œ: ë¯¸ì§€ì˜ ìš´` }] : []),
            ...(hasB30 ? [{ type: 'item', name: '30ê°•ë¶€ìŠ¤í„°', label: `ì•„ì´í…œ: 30ê°•ì˜ ë¶€ìŠ¤í„°` }] : []),
            ...(hasBoosterQuestion ? [{ type: 'item', name: 'ì–´ì©Œë‹¤ë¶€ìŠ¤í„°', label: `ì•„ì´í…œ: ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°?` }] : []),
        ];

        function createRadioButtons(container, groupName, selectVar) {
            availableItems.forEach((item, index) => {
                const label = document.createElement('label');
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = groupName;
                radio.value = index;
                radio.onchange = () => {
                    if (groupName === 'combineA') {
                        selectedCombineA = item;
                    } else {
                        selectedCombineB = item;
                    }
                    // ëª¨ë“  labelì˜ selected í´ë˜ìŠ¤ ì œê±°
                    document.querySelectorAll(`#${container.id} label`).forEach(l => l.classList.remove('selected'));
                    // í˜„ì¬ ì„ íƒëœ labelì— selected í´ë˜ìŠ¤ ì¶”ê°€
                    label.classList.add('selected');
                };

                label.appendChild(radio);
                label.appendChild(document.createTextNode(item.label));
                container.appendChild(label);

                // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                label.addEventListener('mouseenter', () => {
                    if (label.querySelector('input').checked) {
                        label.classList.add('selected');
                    }
                });
                label.addEventListener('mouseleave', () => {
                    if (!label.querySelector('input').checked && !isMouseOverModalCloseButton) { // ë‹«ê¸° ë²„íŠ¼ ìœ„ì— ìˆì§€ ì•Šì„ ë•Œë§Œ í•´ì œ
                        label.classList.remove('selected');
                    }
                });
            });
        }
        
        createRadioButtons(comb1Div, 'combineA', 'selectedCombineA');
        createRadioButtons(comb2Div, 'combineB', 'selectedCombineB');
    }

    function combineItems() {
        if (!selectedCombineA || !selectedCombineB) {
            showMessage('ë‘ ê°œì˜ ì•„ì´í…œì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        // ê°™ì€ ì•„ì´í…œì„ ì„ íƒí–ˆëŠ”ì§€ í™•ì¸ (í˜„ì¬ íë¸ŒëŠ” ì˜ˆì™¸)
        if (selectedCombineA.type === selectedCombineB.type) {
            if (selectedCombineA.type === 'current' || selectedCombineB.type === 'current') {
                // í˜„ì¬ íë¸ŒëŠ” í•­ìƒ í•˜ë‚˜ë°–ì— ì—†ìœ¼ë¯€ë¡œ, ê°™ì€ "í˜„ì¬ íë¸Œ"ë¥¼ ë‘ ë²ˆ ì„ íƒí•˜ëŠ” ê±´ ë¶ˆê°€ëŠ¥.
                // ë§Œì•½ ë™ì¼í•œ ì €ì¥ íë¸Œë‚˜ ì—°ê²° íë¸Œë¥¼ ì„ íƒí–ˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ì¶”ê°€ ë¡œì§ í•„ìš”.
                // í˜„ì¬ ë¡œì§ì—ì„œëŠ” `selectedCombineA`ì™€ `selectedCombineB`ê°€ ê°™ì€ ê°ì²´ë¥¼ ì°¸ì¡°í•  ê²½ìš°ë¥¼ ë°©ì§€í•´ì•¼ í•¨.
                if (selectedCombineA === selectedCombineB) {
                    showMessage('ê°™ì€ ì•„ì´í…œì„ ë‘ ë²ˆ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
            } else if (selectedCombineA.type === 'item' && selectedCombineA.name === selectedCombineB.name && selectedCombineA.name !== 'ì—°ê²°ê³ ë¦¬') {
                showMessage('ê°™ì€ íŠ¹ë³„ ì•„ì´í…œì„ ë‘ ë²ˆ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì—°ê²° ê³ ë¦¬ëŠ” ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)');
                return;
            }
        }



        // ì—°ê²°ê³ ë¦¬ + ë³´ê´€ íë¸Œ ì¡°í•©
        if (
            (selectedCombineA.type === 'item' && selectedCombineA.name === 'ì—°ê²°ê³ ë¦¬' && selectedCombineB.type === 'stored') ||
            (selectedCombineB.type === 'item' && selectedCombineB.name === 'ì—°ê²°ê³ ë¦¬' && selectedCombineA.type === 'stored')
        ) {
            const cube = selectedCombineA.type === 'stored' ? selectedCombineA : selectedCombineB;

            connectedCubes.push({
                level: cube.level,
                id: cube.index
            });

            // ë³´ê´€ íë¸Œ ì‚­ì œ
            storedCubes.splice(cube.index, 1);
            linkCount--;

            showMessage(`${cube.level}ê°• íë¸Œë¥¼ ì—°ê²°í–ˆìŠµë‹ˆë‹¤!`);
            closeModal('combine');
            updateUI();
            saveGame();
            return;
        }
        
        // ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°? + 30ê°• ë³´ê´€ íë¸Œ â†’ 30ê°•ì˜ ë¶€ìŠ¤í„° ìƒì„±
        if (
            hasBoosterQuestion &&
            selectedCombineA.type === 'item' && selectedCombineA.name === 'ì–´ì©Œë‹¤ë¶€ìŠ¤í„°' &&
            selectedCombineB.type === 'stored' && selectedCombineB.level === 30
            ||
            hasBoosterQuestion &&
            selectedCombineB.type === 'item' && selectedCombineB.name === 'ì–´ì©Œë‹¤ë¶€ìŠ¤í„°' &&
            selectedCombineA.type === 'stored' && selectedCombineA.level === 30
        ) {
            hasBoosterQuestion = false;
            hasB30 = true;

       // 30ê°• íë¸Œ ì œê±°
       const index = storedCubes.findIndex(lv => lv === 30);
       if (index !== -1) storedCubes.splice(index, 1);

       showMessage('ì¡°í•© ì„±ê³µ! "30ê°•ì˜ ë¶€ìŠ¤í„°"ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!');
       closeModal('combine');
       updateUI();
       saveGame();
       return;
   }

// ì—°ê²°ëœ íë¸Œë¼ë¦¬ ì¡°í•©
if (selectedCombineA.type === 'connected' && selectedCombineB.type === 'connected') {
    const levelA = selectedCombineA.level;
    const levelB = selectedCombineB.level;

    // íˆë“  100ê°• ì¡°í•© ì¡°ê±´
    if (levelA === 50 && levelB === 50 && !hasHidden100) {
        hasHidden100 = true;
        showMessage('ì „ì„¤ì˜ ì¡°í•© ì„±ê³µ! íˆë“  100ê°• íë¸Œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!');
        closeModal('combine');
        updateUI();
        saveGame();
        return;
    }
    if (storedCubes.length >= 10) {
        showMessage('ë³´ê´€í•¨ì´ ê°€ë“ ì°¨ ìˆì–´ ì¡°í•© ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    // ì¼ë°˜ ì—°ê²° íë¸Œ ì¡°í•©
    let resultLevel = levelA + levelB;
    if (resultLevel > 50) resultLevel = 50;

    storedCubes.push(resultLevel);

    // ì—°ê²° íë¸Œ ì œê±° (ë‘ ê°œ ë‹¤ ì œê±°í•´ì•¼ í•˜ë¯€ë¡œ index ì¡°ì‹¬)
    const ids = [selectedCombineA.id, selectedCombineB.id].sort((a, b) => b - a);
    ids.forEach(id => connectedCubes.splice(id, 1));

    showMessage(`ì—°ê²°ëœ ${levelA}ê°• + ${levelB}ê°•ì„ ì¡°í•©í•˜ì—¬ ${resultLevel}ê°• íë¸Œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`);
    closeModal('combine');
    updateUI();
    saveGame();
    return;
}



        // 4. ë³´ê´€ íë¸Œ ì¡°í•©
        const isStoredCubeA = selectedCombineA.type === 'stored';
        const isStoredCubeB = selectedCombineB.type === 'stored';

        if (isStoredCubeA && isStoredCubeB) {
            const levelA = selectedCombineA.level;
            const levelB = selectedCombineB.level;

            // 0ê°•ê³¼ 50ê°• íë¸Œ ì¡°í•© ì˜ˆì™¸ ì²˜ë¦¬
            if ((levelA === 0 && levelB === 50) || (levelA === 50 && levelB === 0)) {
                if (!hasW50) { // ì´ìƒí•œ 50ê°•ì´ ì•„ì§ ì—†ëŠ” ê²½ìš°ì—ë§Œ íšë“
                    hasW50 = true;
                    // ì‚¬ìš©ëœ ë³´ê´€ íë¸Œ ì œê±°
                    const indicesToRemove = [selectedCombineA.index, selectedCombineB.index].sort((a,b)=>b-a); // í° ì¸ë±ìŠ¤ë¶€í„° ì œê±°
                    storedCubes.splice(indicesToRemove[0], 1);
                    storedCubes.splice(indicesToRemove[1], 1);
                    showMessage('0ê°• íë¸Œì™€ 50ê°• íë¸Œë¥¼ ì¡°í•©í•˜ì—¬ "ì´ìƒí•œ 50ê°•"ì„ íšë“í–ˆìŠµë‹ˆë‹¤!');
                    closeModal('combine');
                    updateUI();
                    saveGame();
                    return;
                } else {
                    showMessage('ì´ë¯¸ "ì´ìƒí•œ 50ê°•"ì„ íšë“í–ˆìŠµë‹ˆë‹¤. ë” ì´ìƒ ì¡°í•©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
            }
            
            // ê·¸ ì™¸ ì¼ë°˜ íë¸Œ ì¡°í•© ë¶ˆê°€ëŠ¥
            showMessage('ì¡°í•© í•  ìˆ˜ ì—†ëŠ” ì¡°í•©ë²•ì…ë‹ˆë‹¤.');
            return;
        }

        // ê·¸ ì™¸ì˜ ê²½ìš° ì¡°í•© ë¶ˆê°€
        showMessage('ì¡°í•©í•  ìˆ˜ ì—†ëŠ” ì•„ì´í…œ ì¡°í•©ì…ë‹ˆë‹¤.');
    }


    function tryClear() {
        const clearConditionsMet = has50 && money >= 1000000 && hasLuck && hasB30 && hasW50;
        if (clearConditionsMet) {
            // Check for hidden clear condition: 100ê°• íë¸Œ ë³´ìœ 
            if (hasHidden100) {
                startHiddenClearAnimation();
            } else {
                startClearScreenAnimation();
            }
        } else {
            showMessage('ì•„ì§ í´ë¦¬ì–´ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!');
        }
    }

    function startClearScreenAnimation() {
        document.getElementById('clearScreen').style.display = 'flex';
        // Disable all buttons except adminToggleBtn and current modal close buttons
        document.querySelectorAll('button:not(#adminToggleBtn):not(.modal button[onclick*="closeModal"])').forEach(btn => btn.disabled = true);
        
        setTimeout(() => {
            // Optionally, reset game or show final message
            // resetGameData(); // Uncomment to reset game after clear
            // window.location.reload(); // Uncomment to refresh page
        }, 10000); // ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ (ì˜ˆ: 10ì´ˆ)
    }

    function startHiddenClearAnimation() {
        document.getElementById('hiddenClear').style.display = 'flex';
        // Disable all buttons
        document.querySelectorAll('button').forEach(btn => btn.disabled = true);

        // Canvas animation for particles
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = Math.random() * 2 + 1;
                this.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
                this.velocity = {
                    x: (Math.random() - 0.5) * 5,
                    y: (Math.random() - 0.5) * 5
                };
                this.alpha = 1;
                this.friction = 0.98;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.01;
            }
        }

        function animateParticles() {
            animationFrameId = requestAnimationFrame(animateParticles);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach((particle, index) => {
                particle.update();
                particle.draw();

                if (particle.alpha <= 0.05 || particle.radius <= 0.5) {
                    particles.splice(index, 1);
                }
            });

            if (Math.random() < 0.5) { // ìŠ¤í°ìœ¨ ì¡°ì ˆ
                particles.push(new Particle(canvas.width / 2, canvas.height / 2));
            }
        }

        // ì‹œì‘ ì‹œ ì•½ê°„ì˜ íŒŒí‹°í´ ìƒì„±
        for (let i = 0; i < 50; i++) {
            particles.push(new Particle(canvas.width / 2, canvas.height / 2));
        }

        animateParticles();

        setTimeout(() => {
            // resetGameData(); // Uncomment to reset game after hidden clear
            // window.location.reload(); // Uncomment to refresh page
        }, 20000); // ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ (ì˜ˆ: 20ì´ˆ)
    }

    // Passwords for special actions
    const passwords = {
        "ë­™ë³½í™ê´€ë¦¬ì": () => {
            showMessage("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”!");
            document.getElementById('adminToggleBtn').style.display = 'block';
            closeModal('passwordModal');
        },
        "í™©ë„ìœ¤ì²œì¬": (levelValue) => {
            if (!isNaN(levelValue) && levelValue >= 0 && levelValue <= 50) {
                level = parseInt(levelValue);
                showMessage(`ê°•í™” ë ˆë²¨ì´ ${level}ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤! í™©ë„ìœ¤ ì²œì¬!`);
                updateUI();
                closeModal('passwordModal');
                saveGame();
            } else {
                showMessage("ìœ íš¨í•˜ì§€ ì•Šì€ ë ˆë²¨ì…ë‹ˆë‹¤. (0-50)");
            }
        },
        "ì´ì§€ìš°ì²œì¬": () => {
            level = MAX_LEVEL;
            money += 100000000; // 1ì–µ ì¶”ê°€
            showMessage('ì´ì§€ìš° ì²œì¬! 1ì–µì›ì„ íšë“í–ˆìŠµë‹ˆë‹¤! ë‹¨ê³„ 50ê°•! ì†”ì§íˆ ì§€ìš°ëŠ” ì²œì¬ì§€ ã…‹ã…‹ã…‹');
            updateUI();
            closeModal('passwordModal');
            saveGame();
        },
        "ì¨ˆë¯¼ì´ëª¨ì´¹": () => {
            level = MAX_LEVEL;
            showMessage('ìµœëŒ€ ê°•í™” ë‹¨ê³„ ë‹¬ì„±! ì¨ˆë¯¼ì´ëª¨ ì§±!');
            updateUI();
            closeModal('passwordModal');
            saveGame();
        },
        "ì—°ê²°ê³ ë¦¬!": () => {
            linkCount += 5;
            showMessage('ì—°ê²° ê³ ë¦¬ 5ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!');
            updateUI();
            closeModal('passwordModal');
            saveGame();
        },
        "ë¯¸ì§€ì˜ ìš´": () => {
            if (!hasLuck) {
                hasLuck = true;
                showMessage('ì•„ì´í…œ "ë¯¸ì§€ì˜ ìš´"ì„ íšë“í–ˆìŠµë‹ˆë‹¤!');
            } else {
                showMessage('ì´ë¯¸ "ë¯¸ì§€ì˜ ìš´"ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.');
            }
            updateUI();
            closeModal('passwordModal');
            saveGame();
        },
        "30ê°•ë¶€ìŠ¤í„°": () => { // ì´ì œ ì´ ë¹„ë°€ë²ˆí˜¸ëŠ” ì•„ì´í…œì„ ì£¼ì§€ ì•Šê³ , ì¡°í•©ì— ëŒ€í•œ ì„¤ëª…ë§Œ.
            showMessage('ì´ì œ "30ê°•ì˜ ë¶€ìŠ¤í„°"ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ íšë“í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. "ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°?"ì™€ "ì—°ê²° ê³ ë¦¬"ë¥¼ ì¡°í•©í•´ë³´ì„¸ìš”!');
            closeModal('passwordModal');
        },
        "ì–´ì©Œë‹¤ë¶€ìŠ¤í„°!": () => {
            if (!hasBoosterQuestion) {
                hasBoosterQuestion = true;
                showMessage('ì•„ì´í…œ "ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°?"ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!');
            } else {
                showMessage('ì´ë¯¸ "ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°?"ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.');
            }
            updateUI();
            closeModal('passwordModal');
            saveGame();
        },
        "ì´ìƒí•œ50ê°•": () => { // ì´ì œ ì´ ë¹„ë°€ë²ˆí˜¸ëŠ” ì•„ì´í…œì„ ì£¼ì§€ ì•Šê³ , ì¡°í•©ì— ëŒ€í•œ ì„¤ëª…ë§Œ.
            showMessage('ì´ì œ "ì´ìƒí•œ 50ê°•"ì€ ë¹„ë°€ë²ˆí˜¸ë¡œ íšë“í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 0ê°• íë¸Œì™€ 50ê°• íë¸Œë¥¼ ì¡°í•©í•´ë³´ì„¸ìš”!');
            closeModal('passwordModal');
        }
    };

    function openPasswordModal() {
        openModal('passwordModal');
    }

    function checkPassword() {
        const input = document.getElementById('passwordInput').value.trim();
        let passwordFound = false;

        // "í™©ë„ìœ¤ì²œì¬[n]" í˜•ì‹ ì²˜ë¦¬
        const doyunMatch = input.match(/^í™©ë„ìœ¤ì²œì¬(\d+)$/);
        if (doyunMatch) {
            passwords["í™©ë„ìœ¤ì²œì¬"](parseInt(doyunMatch[1]));
            passwordFound = true;
        } else if (passwords[input]) {
            passwords[input]();
            passwordFound = true;
        }

        if (!passwordFound) {
            showMessage('ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.');
        }
    }

    function animateCubeColor(status) {
        const upgradeDisplay = document.getElementById('upgradeDisplay');
        let originalBg = colors[Math.min(level, MAX_LEVEL)];
        let flashColor = status === 'success' ? '#2ecc71' : '#e74c3c'; // Green for success, Red for failure

        upgradeDisplay.style.transition = 'none'; // Disable transition for immediate flash
        upgradeDisplay.style.backgroundColor = flashColor;

        setTimeout(() => {
            upgradeDisplay.style.transition = 'background-color 0.3s ease-in-out'; // Re-enable transition
            upgradeDisplay.style.backgroundColor = originalBg; // Restore original color
        }, 100); // Flash duration
    }

    function toggleAutoImmunity() {
        autoImmunity = document.getElementById('autoImmunityToggle').checked;
        showMessage(`ë©´ì œê¶Œ ìë™ ì‚¬ìš©: ${autoImmunity ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
        saveGame();
    }

    function toggleAnimation() {
        enableAnimation = document.getElementById('animationToggle').checked;
        showMessage(`ê°•í™” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼: ${enableAnimation ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
        saveGame();
    }

    function resetGameConfirmed() {
        resetGameData();
        closeModal('resetConfirmModal');
        showMessage('ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
        updateUI();
        saveGame();
    }

    function resetGameData() {
        money = 100;
        level = 0;
        immunity = 0;
        boost = 0;
        lastUpgradeSuccess = true;
        autoImmunity = false;
        enableAnimation = true; // ì´ˆê¸°í™” ì‹œ ì• ë‹ˆë©”ì´ì…˜ ê¸°ë³¸ í™œì„±í™”

        has50 = false;
        hasLuck = false;
        hasB30 = false;
        hasW50 = false;
        linkCount = 0;
        hasBoosterQuestion = false;
        hasHidden100 = false; // íˆë“  100ê°• íë¸Œë„ ì´ˆê¸°í™”

        storedCubes.length = 0;
        connectedCubes.length = 0;
        connectedIdCounter = 0;
        successHistory.length = 0;

        selectedCombineA = null;
        selectedCombineB = null;
        selectedLoadIndex = null;
        
        localStorage.removeItem('cubeGameData'); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì‚­ì œ
        updateUI(); // UI ì—…ë°ì´íŠ¸
    }

    function saveGame() {
        const gameData = {
            money, level, immunity, boost, lastUpgradeSuccess, autoImmunity, enableAnimation,
            has50, hasLuck, hasB30, hasW50, linkCount, hasBoosterQuestion, hasHidden100,
            storedCubes, connectedCubes, connectedIdCounter, successHistory
        };
        localStorage.setItem('cubeGameData', JSON.stringify(gameData));
    }

    function loadGame() {
        const savedData = localStorage.getItem('cubeGameData');
        if (savedData) {
            const gameData = JSON.parse(savedData);
            money = gameData.money !== undefined ? gameData.money : 100;
            level = gameData.level !== undefined ? gameData.level : 0;
            immunity = gameData.immunity !== undefined ? gameData.immunity : 0;
            boost = gameData.boost !== undefined ? gameData.boost : 0;
            lastUpgradeSuccess = gameData.lastUpgradeSuccess !== undefined ? gameData.lastUpgradeSuccess : true;
            autoImmunity = gameData.autoImmunity !== undefined ? gameData.autoImmunity : false;
            enableAnimation = gameData.enableAnimation !== undefined ? gameData.enableAnimation : true;

            has50 = gameData.has50 !== undefined ? gameData.has50 : false;
            hasLuck = gameData.hasLuck !== undefined ? gameData.hasLuck : false;
            hasB30 = gameData.hasB30 !== undefined ? gameData.hasB30 : false;
            hasW50 = gameData.hasW50 !== undefined ? gameData.hasW50 : false;
            linkCount = gameData.linkCount !== undefined ? gameData.linkCount : 0;
            hasBoosterQuestion = gameData.hasBoosterQuestion !== undefined ? gameData.hasBoosterQuestion : false;
            hasHidden100 = gameData.hasHidden100 !== undefined ? gameData.hasHidden100 : false;


            storedCubes.splice(0, storedCubes.length, ...(gameData.storedCubes || []));
            connectedCubes.splice(0, connectedCubes.length, ...(gameData.connectedCubes || []));
            connectedIdCounter = gameData.connectedIdCounter !== undefined ? gameData.connectedIdCounter : 0;
            successHistory.splice(0, successHistory.length, ...(gameData.successHistory || []));
        }
    }

    // Admin Panel functions
    function toggleAdminPanel() {
        const adminPanel = document.getElementById('adminPanel');
        const adminToggleBtn = document.getElementById('adminToggleBtn');
        if (adminPanel.classList.contains('open')) {
            adminPanel.classList.remove('open');
            adminPanel.style.display = 'none';
            adminToggleBtn.innerText = 'ğŸ”’ ê´€ë¦¬ì íŒ¨ë„';
        } else {
            adminPanel.classList.add('open');
            adminPanel.style.display = 'block';
            adminToggleBtn.innerText = 'âœ– ë‹«ê¸°';
        }
    }

    function adminAddMoney() {
        money += 1000000;
        showMessage('ê´€ë¦¬ì: ëˆ 1,000,000ì› ì¶”ê°€!');
        updateUI();
        saveGame();
    }

    function adminSetLevel() {
        level = 50;
        showMessage('ê´€ë¦¬ì: ê°•í™” ë‹¨ê³„ 50ìœ¼ë¡œ ì„¤ì •!');
        updateUI();
        saveGame();
    }

    function adminGetAllItems() {
        has50 = true;
        hasLuck = true;
        hasB30 = true;
        hasW50 = true;
        linkCount += 10;
        hasBoosterQuestion = true;
        showMessage('ê´€ë¦¬ì: ëª¨ë“  í´ë¦¬ì–´ ì•„ì´í…œì„ íšë“í–ˆìŠµë‹ˆë‹¤!');
        updateUI();
        saveGame();
    }

    function adminAddImmunity() {
        immunity += 10;
        showMessage('ê´€ë¦¬ì: ë©´ì œê¶Œ 10ê°œ ì¶”ê°€!');
        updateUI();
        saveGame();
    }

    function adminAddLink() {
        linkCount += 5;
        showMessage('ê´€ë¦¬ì: ì—°ê²° ê³ ë¦¬ 5ê°œ ì¶”ê°€!');
        updateUI();
        saveGame();
    }

    function adminAddBoosterQuestion() {
        hasBoosterQuestion = true;
        showMessage('ê´€ë¦¬ì: ì–´ì©Œë‹¤ ë¶€ìŠ¤í„°? íšë“!');
        updateUI();
        saveGame();
    }

    function adminAddHidden100() {
        hasHidden100 = true;
        showMessage('ê´€ë¦¬ì: (íˆë“ )100ê°• íë¸Œ íšë“!');
        updateUI();
        saveGame();
    }

    // Initialize game on page load
    window.onload = initGame;

</script>
</body>
</html>