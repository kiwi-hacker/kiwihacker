<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëˆ ë£°ë › ê²Œì„</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      background-color: white; /* ë£°ë › ê²Œì„ ë°°ê²½ í°ìƒ‰ */
      color: black;            /* ë£°ë › ê²Œì„ í°íŠ¸ ê²€ì •ìƒ‰ */
      user-select: none;
      overflow-x: hidden;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    #money, #loan, #day {
      font-size: 24px;
      margin: 10px;
      text-shadow: 1px 1px 2px #ccc;
    }

    #message {
      font-size: 18px;
      color: black;
      text-shadow: 1px 1px 2px #ccc;
      min-height: 24px;
      margin-bottom: 10px;
    }

    #gameOver, #winGame, #finalChoice {
      display: none;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      gap: 10px;
      justify-content: center;
      margin: 20px auto;
    }

    .square-btn {
      width: 100px;
      height: 100px;
      font-size: 20px;
      cursor: pointer;
    }

    #winGame {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 42px;
      color: black;
      text-shadow: 2px 2px 6px #ccc;
    }

    /* === ì´ì•Œ í”¼í•˜ê¸° ê²Œì„ ì˜ì—­ === */
    #bulletGame {
      display: none;
      position: relative;
      width: 360px;
      margin: 0 auto;
      user-select: none;
      background-color: black;
      color: white; /* ì´ì•Œ í”¼í•˜ê¸° í°íŠ¸ í°ìƒ‰ */
    }

    #gameCanvas {
      background-color: #111;
      border: 2px solid white;
      display: block;
      margin: 20px auto 0 auto;
      touch-action: none;
    }

    #countdown {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 72px;
      color: lime;
      text-shadow: 2px 2px 6px black;
      user-select: none;
      pointer-events: none;
    }

    #bulletMessage {
      color: white;
      text-align: center;
      margin-top: 10px;
      font-size: 16px;
      user-select: none;
    }
  </style>
</head>
<body>

  <div id="rouletteGame">
    <h1 id="title">ëˆ ë£°ë › ê²Œì„ (1ë‹¨ê³„ - 1000ì›ì„ ëª¨ì•„ë¼! 100ì¼ì•ˆì—??)</h1>
    <div id="day">Day: 1</div>
    <div id="money">í˜„ì¬ ëˆ: 100ì›</div>
    <div id="loan">ëŒ€ì¶œê¸ˆ: 0ì›</div>
    <button id="rouletteBtn" onclick="spinRoulette()">ë£°ë › ëŒë¦¬ê¸°</button>
    <button onclick="takeLoan()">100ì› ëŒ€ì¶œ</button>
    <button id="clickBtn" onclick="clickToEarn()">ëˆ„ë¥´ê¸° (+1ì›)</button>
    <button onclick="secretAddMoney()">ë¹„ë°€ ë²„íŠ¼</button>
    <button id="hardcoreBtn" onclick="activateHardcore()">í•˜ë“œì½”ì–´</button>
    <button onclick="lifeReverse()" id="lifeReverseBtn" style="display:none;">ì¸ìƒì—­ì „</button>
    <div id="message">ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!</div>
    <div id="gameOver"><h2 id="gameOverMsg">íŒŒì‚°! ê²Œì„ ì˜¤ë²„!</h2></div>
    <div id="winGame"></div>
    <div id="finalChoice"></div>
  </div>

  <div id="bulletGame">
    <canvas id="gameCanvas" width="360" height="600"></canvas>
    <div id="countdown"></div>
    <div id="bulletMessage">ì¢Œìš°ë¡œ ì›€ì§ì´ë©° ì´ì•Œì„ í”¼í•˜ì„¸ìš”! (100ì´ˆ ë²„í‹°ë©´ í´ë¦¬ì–´)</div>
  </div>

  <script>
    // ë£°ë › ê²Œì„ ê´€ë ¨ ë³€ìˆ˜
    let money = 100, loan = 0, day = 1, stage = 1, retryCount = 0;
    let clickCooldown = false, clickPressCount = 0;
    let isHardcore = false, hardcoreUsed = false, lifeReverseUsed = false, inFinalStage = false;
    let dayInterval;

    const dayLimit = {1: 100, 2: 30, 3: 10};
    const goalMoney = {1: 1000, 2: 2000, 3: 30000};

    // --- ë£°ë › ê²Œì„ í•¨ìˆ˜ë“¤ ---

    function updateDisplay() {
      document.getElementById("money").innerText = `í˜„ì¬ ëˆ: ${Math.floor(money)}ì›`;
      document.getElementById("loan").innerText = `ëŒ€ì¶œê¸ˆ: ${Math.floor(loan)}ì›`;
      document.getElementById("day").innerText = `Day: ${day}`;
      document.getElementById("clickBtn").innerText = `ëˆ„ë¥´ê¸° (+1ì›)`;
      if (stage === 3) {
        document.getElementById("lifeReverseBtn").style.display = money >= 500 && !lifeReverseUsed ? "inline-block" : "none";
      } else {
        document.getElementById("lifeReverseBtn").style.display = "none";
      }
    }

    function clickToEarn() {
      if (money <= -300 || clickCooldown) return;
      if (stage === 2) {
        clickPressCount++;
        if (clickPressCount >= 2) {
          money += 1;
          clickPressCount = 0;
          document.getElementById("message").innerText = "+1ì› íšë“!";
        } else {
          document.getElementById("message").innerText = "í•œ ë²ˆ ë” ëˆŒëŸ¬ì•¼ ëˆì´ ë“¤ì–´ì˜µë‹ˆë‹¤.";
        }
        clickCooldown = true;
        document.getElementById("clickBtn").disabled = true;
        setTimeout(() => {
          clickCooldown = false;
          document.getElementById("clickBtn").disabled = false;
        }, 300);
      } else {
        money += 1;
        document.getElementById("message").innerText = "+1ì› íšë“!";
      }
      checkLoanRepayment();
      checkGameStatus();
      updateDisplay();
    }

    function spinRoulette() {
      if (money <= -300) return;
      const r = Math.random();
      let result, msg = "ë£°ë › ê²°ê³¼: ";
      if (r < 0.001) result = -400;
      else if (r < 0.01) result = "0ì›";
      else if (r < 0.02) result = -100;
      else {
        const options = [0.1, 0.5, 1, 1.5, 2, "+150"];
        result = options[Math.floor(Math.random() * options.length)];
      }
      if (result === "0ì›") {
        money = 0;
        msg += "0ì›ë¨!";
      } else if (result === -100 || result === -400) {
        money += result;
        msg += `${result}ì› ê°ì†Œ!`;
      } else if (typeof result === "string") {
        const plus = parseInt(result.slice(1));
        money += plus;
        msg += `+${plus}ì› ì¦ê°€!`;
      } else {
        const before = money;
        money *= result;
        msg += `${result}ë°° (${Math.floor(money - before)}ì› ë³€í™”!)`;
      }
      document.getElementById("message").innerText = msg;
      checkLoanRepayment();
      checkGameStatus();
      updateDisplay();
    }

    function takeLoan() {
      if (stage !== 1) return alert("2ë‹¨ê³„ ì´ìƒì—ì„œëŠ” ëŒ€ì¶œì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤");
      if (loan > 0) return alert("ì´ë¯¸ ëŒ€ì¶œí–ˆìŠµë‹ˆë‹¤");
      loan = 100; money += 100;
      document.getElementById("message").innerText = "100ì› ëŒ€ì¶œë°›ì•˜ìŠµë‹ˆë‹¤. í•˜ë£¨ë§ˆë‹¤ 10% ì´ì!";
      updateDisplay();
    }

    function checkLoanRepayment() {
      if (loan > 0 && money >= loan) {
        money -= loan;
        loan = 0;
        document.getElementById("message").innerText += " ëŒ€ì¶œ ìƒí™˜ ì™„ë£Œ!";
      }
    }

    function secretAddMoney() {
      const pw = prompt("ë¹„ë°€ë²ˆí˜¸ ì…ë ¥:");
      if (pw === "0822") {
        money += 500;
        document.getElementById("message").innerText = "500ì› ëª°ë˜ íšë“!";
      } else if (pw === "1203") {
        money += 2000;
        document.getElementById("message").innerText = "2000ì› ëª°ë˜ íšë“!";
      } else alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤");
      updateDisplay();
    }

    function lifeReverse() {
      if (stage !== 3 || lifeReverseUsed || money < 500) return;
      lifeReverseUsed = true;
      if (Math.random() < 0.5) {
        money *= 10;
        alert("ì¸ìƒì—­ì „ ì„±ê³µ! ëˆ 10ë°°!");
      } else {
        money = 0;
        alert("ì¸ìƒì—­ì „ ì‹¤íŒ¨... ëˆ 0ì›...");
      }
      updateDisplay();
      checkGameStatus();
    }

    function activateHardcore() {
      if (hardcoreUsed) {
        document.getElementById("message").innerText = "ì´ë¯¸ í•˜ë“œì½”ì–´ì…ë‹ˆë‹¤.";
        return;
      }
      hardcoreUsed = true; isHardcore = true;
      document.getElementById("title").innerText += " í•˜ë“œì½”ì–´!";
      resetDayInterval();
    }

    function resetDayInterval() {
      clearInterval(dayInterval);
      const intervalTime = isHardcore ? (stage === 3 ? 2000 : 1000) : 30000;
      dayInterval = setInterval(() => {
        day++;
        if (loan > 0) {
          loan = Math.ceil(loan * 1.1); // 10% ì´ì ë§¤ì¼ ì¦ê°€
        }
        checkDayLimit();
        updateDisplay();
      }, intervalTime);
    }

    function checkDayLimit() {
      if ((stage === 1 && day > dayLimit[1]) ||
          (stage === 2 && day > dayLimit[2]) ||
          (stage === 3 && day > dayLimit[3])) {
        endGame("ì‹œê°„ ì´ˆê³¼! ê²Œì„ ì˜¤ë²„!");
      }
    }

    function endGame(msg) {
      document.getElementById("gameOverMsg").innerText = msg;
      document.getElementById("gameOver").style.display = "block";
      disableGame();
    }

    function disableGame() {
      document.querySelectorAll("button").forEach(b => b.disabled = true);
    }

    function checkGameStatus() {
      if (money <= -300) return endGame("íŒŒì‚°! ê²Œì„ ì˜¤ë²„!");
      if (loan > 0 && loan > goalMoney[stage]) return endGame("ë¹šìŸì´!");
      if (stage === 1 && money >= goalMoney[1]) return showStage1Choice();
      if (stage === 2 && money >= goalMoney[2] && !inFinalStage) return showFinalChoice();
      if (stage === 3 && money >= goalMoney[3]) return clearGame();
    }

    function showStage1Choice() {
      stage = -1;
      const htmlBackup = document.documentElement.innerHTML;
      document.body.innerHTML = `<h2>ì„±ê³µ ë²„íŠ¼ì„ ì°¾ì•„ë³´ì„¸ìš”!</h2><div class="grid" id="choiceGrid"></div><div id="result"></div>`;
      const grid = document.getElementById("choiceGrid");
      let btnCount = Math.max(1, 9 - retryCount);
      let correct = Math.floor(Math.random() * btnCount);
      for (let i = 0; i < btnCount; i++) {
        const btn = document.createElement("button");
        btn.className = "square-btn"; btn.innerText = i + 1;
        btn.onclick = () => {
          if (i === correct) {
            stage = 2; money = 0; day = 1; inFinalStage = false; retryCount = 0;
            document.documentElement.innerHTML = htmlBackup;
            document.getElementById("title").innerText = `ëˆ ë£°ë › ê²Œì„ (2ë‹¨ê³„ - 2000ì›ì„ ëª¨ì•„ë¼! 30ì¼ì•ˆì—??)${isHardcore ? " í•˜ë“œì½”ì–´!" : ""}`;
            resetDayInterval(); updateDisplay();
          } else {
            retryCount++;
            document.getElementById("result").innerText = "ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.";
          }
        };
        grid.appendChild(btn);
      }
    }

    function showFinalChoice() {
      inFinalStage = true;
      const htmlBackup = document.documentElement.innerHTML;
      document.body.innerHTML = `<h2>ìµœì¢… ì„ íƒ! í•˜ë‚˜ë¥¼ ê³ ë¥´ì„¸ìš”</h2><div class="grid" id="finalGrid"></div>`;
      const grid = document.getElementById("finalGrid");
      const correct = Math.floor(Math.random() * 2);
      for (let i = 0; i < 2; i++) {
        const btn = document.createElement("button");
        btn.className = "square-btn";
        btn.innerText = i === 0 ? "ì„ íƒ A" : "ì„ íƒ B";
        btn.onclick = () => {
          if (i === correct) {
            stage = 3; money = 0; day = 1;
            document.documentElement.innerHTML = htmlBackup;
            document.getElementById("title").innerText = `ëˆ ë£°ë › ê²Œì„ (3ë‹¨ê³„ - 30000ì›ì„ ëª¨ì•„ë¼! 10ì¼ì•ˆì—??)${isHardcore ? " í•˜ë“œì½”ì–´!" : ""}`;
            resetDayInterval(); updateDisplay();
          } else {
            return endGame("ê²Œì„ ì˜¤ë²„!");
          }
        };
        grid.appendChild(btn);
      }
    }

    // ì—¬ê¸°ì„œë¶€í„° ì´ì•Œ í”¼í•˜ê¸° ê²Œì„ ì‹œì‘ í•¨ìˆ˜ë¡œ ì „í™˜

    function clearGame() {
      // 3ë‹¨ê³„ í´ë¦¬ì–´ ì‹œ ì´ì•Œ ê²Œì„ ì‹œì‘
      document.getElementById("rouletteGame").style.display = "none";
      document.getElementById("bulletGame").style.display = "block";
      startBulletGame();
    }

    // --- ì´ì•Œ í”¼í•˜ê¸° ê²Œì„ ì½”ë“œ ---

    function startBulletGame() {
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      const countdownEl = document.getElementById('countdown');
      const bulletMessage = document.getElementById('bulletMessage');

      let countdown = 3;
      countdownEl.innerText = countdown;
      bulletMessage.style.display = "none";

      // í”Œë ˆì´ì–´ ë° ì´ì•Œ ë³€ìˆ˜ ì´ˆê¸°í™”
      const player = {
        x: canvas.width / 2 - 15,
        y: canvas.height - 60,
        width: 30,
        height: 30,
        speed: 4,
        color: 'lime'
      };
      const bullets = [];
      let keys = {};
      let touchDirection = { left: false, right: false };
      let gameOver = false;
      let gameClear = false;
      let startTime = null;
      let lastBulletTime = 0;

      // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
      function keyDownHandler(e) { keys[e.key] = true; }
      function keyUpHandler(e) { keys[e.key] = false; }

      document.addEventListener('keydown', keyDownHandler);
      document.addEventListener('keyup', keyUpHandler);

      // í„°ì¹˜ ì´ë²¤íŠ¸
      canvas.addEventListener('touchstart', handleTouch);
      canvas.addEventListener('touchmove', handleTouch);
      canvas.addEventListener('touchend', () => { touchDirection = { left: false, right: false }; });

      function handleTouch(e) {
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        touchDirection.left = x < canvas.width / 2;
        touchDirection.right = x > canvas.width / 2;
      }

      // í”Œë ˆì´ì–´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updatePlayer() {
        if (keys['ArrowLeft'] || touchDirection.left) player.x -= player.speed;
        if (keys['ArrowRight'] || touchDirection.right) player.x += player.speed;
        player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      }

      // ê·¸ë¦¬ê¸° í•¨ìˆ˜ë“¤
      function drawPlayer() {
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }
      function drawBullets() {
        ctx.fillStyle = 'red';
        bullets.forEach(b => ctx.fillRect(b.x, b.y, b.size, b.size));
      }
      function drawTime(elapsed) {
        ctx.fillStyle = 'white';
        ctx.font = '16px Arial';
        ctx.fillText(`ìƒì¡´ ì‹œê°„: ${elapsed.toFixed(1)}ì´ˆ`, 10, 20);
      }

      // ì´ì•Œ ìƒì„±
      function spawnBullet(elapsed) {
        const size = 10;
        const x = Math.random() * (canvas.width - size);
        let speed = 2 + Math.random() * 2;
        if (elapsed >= 60) speed += 2;
        bullets.push({ x, y: -size, size, speed });
      }

      // ì´ì•Œ ë° ì¶©ëŒ ì—…ë°ì´íŠ¸
      function updateBullets() {
        for (let i = bullets.length - 1; i >= 0; i--) {
          const b = bullets[i];
          b.y += b.speed;

          if (
            b.x < player.x + player.width &&
            b.x + b.size > player.x &&
            b.y < player.y + player.height &&
            b.y + b.size > player.y
          ) {
            gameOver = true;
          }

          if (b.y > canvas.height) bullets.splice(i, 1);
        }
      }

      // ê²Œì„ ë£¨í”„
      function gameLoop(currentTime) {
        if (!startTime) startTime = currentTime;
        const elapsed = (currentTime - startTime) / 1000;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (gameOver) {
          ctx.fillStyle = "rgba(0,0,0,0.7)";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "red";
          ctx.font = "32px Arial";
          ctx.fillText("ê²Œì„ ì˜¤ë²„!", canvas.width / 2 - 80, canvas.height / 2 - 20);
          ctx.fillStyle = "white";
          ctx.fillText(`ìƒì¡´: ${elapsed.toFixed(1)}ì´ˆ`, canvas.width / 2 - 60, canvas.height / 2 + 30);
          return;
        }

        if (gameClear) {
          ctx.fillStyle = "black";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "lime";
          ctx.font = "30px Arial";
          ctx.fillText("ğŸ‰ í´ë¦¬ì–´ ì„±ê³µ! ğŸ‰", canvas.width / 2 - 110, canvas.height / 2);
          return;
        }

        if (elapsed >= 100) {
          gameClear = true;
        }

        updatePlayer();
        updateBullets();
        drawPlayer();
        drawBullets();
        drawTime(elapsed);

        if (currentTime - lastBulletTime > 500) {
          spawnBullet(elapsed);
          lastBulletTime = currentTime;
        }

        requestAnimationFrame(gameLoop);
      }

      // ì¹´ìš´íŠ¸ë‹¤ìš´ í›„ ê²Œì„ ì‹œì‘
      function countdownTick() {
        if (countdown === 0) {
          countdownEl.style.display = "none";
          bulletMessage.style.display = "block";
          requestAnimationFrame(gameLoop);
          return;
        }
        countdownEl.innerText = countdown;
        countdown--;
        setTimeout(countdownTick, 1000);
      }

      bulletMessage.style.display = "none";
      countdownEl.style.display = "block";
      countdownTick();
    }

    // ì´ˆê¸° ì„¸íŒ…
    resetDayInterval();
    updateDisplay();

  </script>

</body>
</html>